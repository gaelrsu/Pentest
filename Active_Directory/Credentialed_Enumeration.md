# Credentialed Enumeration - from Linux

## User Enumeration with crackmapexec
```bash
crackmapexec smb 192.168.110 -u user -p mypasswd1 --users
```
## Group Enumeration with crackmapexec
```bash
crackmapexec smb 192.168.110 -u user -p mypasswd1 --groups
```
## Share Enumeration 
### crackmapexec
```bash
crackmapexec smb 192.168.110 -u user -p mypasswd1 --shares
```
```bash
# spider_plus will dig through each readable share on the host and list all readable files.
crackmapexec smb 192.168.1.10 -u user -p mypasswd1 -M spider_plus --share 'SHAREFILE'
```
### SMBMap
```bash
smbmap -u user -p passwd1 -d INLANEFREIGHT.LOCAL -H 192.168.1.10
```
### rpcclient 
```bash
#use with the Samba protocol and to provide extra functionality via MS-RPC. It can enumerate, add, change, and even remove objects from AD.
rpcclient -U "" -N 192.168.1.10
# => that will open a null session
rpcclient $> queryuser RIDvalueHex
# to know the RID :
rpcclient $> enumdomusers
``` 
## Impacket Toolkit
toolkit to enumerate, interact, and exploit Windows protocols and find the information (on Python). 
### Psexec.py
```bash
# The tool creates a remote service by uploading a randomly-named executable to the ADMIN$ share on the target host.
# To connect to a host with psexec.py, we need credentials for a user with local administrator privileges.
psexec.py MYDOMAIN.local/USER:'PASSWORD'@192.168.1.10
``` 
### wmiexec.py
```bash
# Wmiexec.py utilizes a semi-interactive shell Wmiexec.py utilizes a semi-interactive shell
wmiexec.py YDOMAIN.local/USER:'PASSWORD'@192.168.1.10
``` 
### Windapsearch
```bash
# use to enumerate users, groups, and computers from a Windows domain by utilizing LDAP queries. EXEMPLE for domain admin :
python3 windapsearch.py --dc-ip 192.168.1.10 -u USER@MYDOMAIN.local -p PASSWORD --da
# EXEMPLE for Privileged Users
python3 windapsearch.py --dc-ip 192.168.1.10 -u USER@MYDOMAIN.local -p PASSWORD -PU
```
### Bloodhound
```bash
sudo bloodhound-python -u 'USER' -p 'PASSWORD' -ns 192.168.1.10 -d mydomain.local -c all
# After that you can upload the file into the BloodHound GUI
``` 
___________________________________________________________________________________________________________
# Credentialed Enumeration - from Windows
## ActiveDirectory PowerShell
### Discover Modules
```powershell
# to list all available modules, their version, and potential commands for use.
Get-Module
# Get-Module
Import-Module ActiveDirectory
```
### Get Domain Info
```powershell
Get-ADDomain
```
### Get User info
```powershell
Get-ADUser -Filter {ServicePrincipalName -ne "$null"} -Properties ServicePrincipalName
# This will get us a listing of accounts that may be susceptible to a Kerberoasting attack.
```
### Checking For Trust Relationships
```powershell
Get-ADTrust -Filter *
```
### Group Enumeration
```powershell
Get-ADGroup -Filter * | select name
# See info from a group :
Get-ADGroup -Identity "Finance"
```
### Group Membership
```powershell
Get-ADGroupMember -Identity "Finance"
```
## PowerView
Provides a way to identify where users are logged in on a network, enumerate domain information such as users, computers, groups, ACLS, trusts, hunt for file shares and passwords, perform Kerberoasting... 
https://book.hacktricks.xyz/windows-hardening/basic-powershell-for-pentesters/powerview
Exemple with 
### Domain User Information 
```powershell
Get-DomainUser -Identity username -Domain mydomain.local | Select-Object -Property name,samaccountname,description,memberof,whencreated,pwdlastset,lastlogontimestamp,accountexpires,admincount,userprincipalname,serviceprincipalname,useraccountcontrol
```
### Recursive Group Membership
```powershell
Get-DomainGroupMember -Identity "Administrator" -Recurse
```
### Trust Enumeration
```powershell
Get-DomainTrustMapping
```
### Testing for Local Admin Access
```powershell
Test-AdminAccess -ComputerName COMPUTERNAME
```
## SharpView
### enumerate information about a specific user
```powershell
.\SharpView.exe Get-DomainUser -Identity USER
```
## Snaffler
Snaffler is a tool that can help us acquire credentials or other sensitive data in an Active Directory environment.
```powershell
Snaffler.exe -s -d mydomain.local -o snaffler.log -v data
```

## SharpHound
collect data to send into BloddHound
```powershell
.\SharpHound.exe -c All --zipfilename DOMAIN
``` 














