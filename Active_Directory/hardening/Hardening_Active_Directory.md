# Hardening Active Directory

Things To Document and Track

    Naming conventions of OUs, computers, users, groups
    DNS, network, and DHCP configurations
    An intimate understanding of all GPOs and the objects that they are applied to
    Assignment of FSMO roles
    Full and current application inventory
    A list of all enterprise hosts and their location
    Any trust relationships we have with other domains or outside entities
    Users who have elevated permissions



    The organization should have a strong password policy, with a password filter that disallows the use of common words (i.e., welcome, password, names of months/days/seasons, and the company name). 
    Rotate passwords periodically for all service accounts.
    Disallow local administrator access on user workstations unless a specific business need exists.
    Disable the default RID-500 local admin account and create a new admin account for administration subject to LAPS password rotation.
    Implement split tiers of administration for administrative users. 
    Clean up privileged groups.
    Where appropriate, place accounts in the Protected Users group.
    Disable Kerberos delegation for administrative accounts.

## Protected Users Group
The Protected Users group first appeared with Window Server 2012 R2. This group can be used to restrict what members of this privileged group can do in a domain. 
Adding users to Protected Users prevents user credentials from being abused if left in memory on a host.
```powershell
Get-ADGroup -Identity "Protected Users" -Properties Name,Description,Members

    Group members can not be delegated with constrained or unconstrained delegation.
    CredSSP will not cache plaintext credentials in memory even if Allow delegating default credentials is set within Group Policy.
    Windows Digest will not cache the user's plaintext password, even if Windows Digest is enabled.
    Members cannot authenticate using NTLM authentication or use DES or RC4 keys.
    After acquiring a TGT, the user's long-term keys or plaintext credentials are not cached.
    Members cannot renew a TGT longer than the original 4-hour TTL.

```
## Processes

    Proper policies and procedures for AD asset management.
        AD host audit, the use of asset tags, and periodic asset inventories can help ensure hosts are not lost.
    Access control policies (user account provisioning/de-provisioning), multi-factor authentication mechanisms.
    Processes for provisioning and decommissioning hosts (i.e., baseline security hardening guideline, gold images)
    AD cleanup policies
        Are accounts for former employees removed or just disabled?
        What is the process for removing stale records from AD?
        Processes for decommissioning legacy operating systems/services (i.e., proper uninstallation of Exchange when migrating to 0365).
        Schedule for User, groups, and hosts audit.
        
## Technology

    Run tools such as BloodHound, PingCastle, and Grouper periodically to identify AD misconfigurations.
    Ensure that administrators are not storing passwords in the AD account description field.
    Review SYSVOL for scripts containing passwords and other sensitive data.
    Avoid the use of "normal" service accounts, utilizing Group Managed (gMSA) and Managed Service Accounts (MSA) where ever possible to mitigate the risk of Kerberoasting.
    Disable Unconstrained Delegation wherever possible.
    Prevent direct access to Domain Controllers through the use of hardened jump hosts.
    Consider setting the ms-DS-MachineAccountQuota attribute to 0, which disallows users from adding machine accounts and can prevent several attacks such as the noPac attack and Resource-Based Constrained Delegation (RBCD)
    Disable the print spooler service wherever possible to prevent several attacks
    Disable NTLM authentication for Domain Controllers if possible
    Use Extended Protection for Authentication along with enabling Require SSL only to allow HTTPS connections for the Certificate Authority Web Enrollment and Certificate Enrollment Web Service services
    Enable SMB signing and LDAP signing
    Take steps to prevent enumeration with tools like BloodHound
    Ideally, perform quarterly penetration tests/AD security assessments, but if budget constraints exist, these should be performed annually at the very least.
    Test backups for validity and review/practice disaster recovery plans.
    Enable the restriction of anonymous access and prevent null session enumeration by setting the RestrictNullSessAccess registry key to 1 to restrict null session access to unauthenticated users.
    
## MITRE ATT&CK
As a different look at this, we have broken out the significant actions by section and correlated controls based on the TTP and a MITRE tag. Each tag corresponds with a section of the Enterprise ATT&CK Matrix found here. Any tag marked as TA corresponds to an overarching tactic, while a tag marked as T### is a technique found in the matrix under tactics.





